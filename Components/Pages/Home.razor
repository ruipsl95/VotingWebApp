@page "/"
@using VotingSystem.Voting
@using Grpc.Core
@inject VotingService.VotingServiceClient VotingClient

<PageTitle>Início - Sistema de Votação</PageTitle>

<div class="text-center mt-5">
    <h1 class="display-4 fw-bold text-primary">Sistema de Votação Eletrónica</h1>
    <p class="lead text-muted">Trabalho Prático de Integração de Sistemas - UAB 2025</p>

    <div class="my-4">
        <span class="badge @statusBadgeClass p-2 fs-6">
            Estado do Servidor: @serverStatus
        </span>
    </div>
</div>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-5 mb-4">
            <div class="card h-100 shadow-sm border-primary">
                <div class="card-body text-center">
                    <div class="fs-1 mb-3"><svg id='Map_Travel_Politics_Vote_2_24' width='44' height='44'
                            viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'
                            xmlns:xlink='http://www.w3.org/1999/xlink'>
                            <rect width='34' height='34' stroke='none' fill='#000000' opacity='0' />
                            <g transform="matrix(0.42 0 0 0.42 12 12)">
                                <g style="">
                                    <g transform="matrix(1 0 0 1 0 10.75)">
                                        <path
                                            style="stroke: rgb(0,0,1); stroke-width: 3; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-24, -34.75)"
                                            d="M 45.0002 24.5 L 45.0002 30.9999 C 45.0002 35.027 44.8141 38.0612 44.6024 40.2096 C 44.3565 42.7055 42.3438 44.4982 39.8396 44.6354 C 36.6179 44.8118 31.4381 44.9999 24.0002 44.9999 C 16.5624 44.9999 11.3825 44.8118 8.16084 44.6354 C 5.65664 44.4982 3.644 42.7055 3.39808 40.2096 C 3.1864 38.0612 3.00023 35.027 3.00023 30.9999 L 3 24.5"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 0 0.53)">
                                        <path
                                            style="stroke: rgb(0,0,1); stroke-width: 3; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-24, -24.53)"
                                            d="M 12 16.0859 C 10.2902 16.123 8.87124 16.1648 7.72732 16.2047 C 5.44379 16.2844 3.5061 17.7484 3.2392 20.0177 C 3.10119 21.191 3 22.666 3 24.4686 C 3 26.2712 3.10119 27.7461 3.2392 28.9195 C 3.50611 31.1887 5.44101 32.6526 7.72454 32.7324 C 10.9062 32.8435 16.2168 32.9686 24 32.9686 C 31.7832 32.9686 37.0938 32.8435 40.2755 32.7324 C 42.559 32.6526 44.4939 31.1887 44.7608 28.9194 C 44.8988 27.7461 45 26.2712 45 24.4686 C 45 22.666 44.8988 21.191 44.7608 20.0177 C 44.4939 17.7484 42.5571 16.2844 40.2736 16.2047 C 39.7423 16.1862 39.1516 16.1672 38.5 16.1485"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 0 0.53)">
                                        <path
                                            style="stroke: rgb(0,0,1); stroke-width: 3; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-24, -24.53)"
                                            d="M 33 22.0537 C 34.1229 22.0691 34.9515 22.085 35.5073 22.0973 C 36.0648 22.1097 36.5942 22.369 36.7681 22.8989 C 36.8931 23.2796 37 23.8078 37 24.5005 C 37 25.1931 36.8931 25.7213 36.7681 26.1021 C 36.5942 26.6319 36.0657 26.8912 35.5082 26.9036 C 33.9567 26.938 30.2774 27.0005 24 27.0005 C 17.7226 27.0004 14.0433 26.938 12.4918 26.9036 C 11.9343 26.8912 11.4058 26.6319 11.2319 26.1021 C 11.1069 25.7213 11 25.1931 11 24.5004 C 11 23.8078 11.1069 23.2796 11.2319 22.8988 C 11.4058 22.369 11.9352 22.1097 12.4927 22.0973 C 13.0485 22.085 13.877 22.0691 14.9998 22.0537"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 2 -11)">
                                        <path
                                            style="stroke: rgb(0,0,1); stroke-width: 3; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-26, -13)"
                                            d="M 17.3163 12.0177 C 15.8855 13.5689 15.7971 15.8257 17.2086 17.3946 C 17.786 18.0364 18.4944 18.7884 19.3538 19.6475 C 20.2132 20.5068 20.9654 21.2151 21.6073 21.7924 C 23.1764 23.2035 25.4331 23.1147 26.984 21.6837 C 27.994 20.7518 29.2979 19.509 30.9038 17.9029 C 32.5096 16.2969 33.7521 14.9928 34.6838 13.9827 C 36.1147 12.4315 36.2031 10.1747 34.7916 8.60588 C 34.2142 7.96409 33.5058 7.21209 32.6464 6.35291 C 31.787 5.49366 31.0348 4.78536 30.3928 4.20804 C 28.8238 2.79694 26.5671 2.88573 25.0162 4.31675 C 24.0062 5.24864 22.7022 6.49145 21.0964 8.09754 C 19.4906 9.70356 18.2481 11.0077 17.3163 12.0177 Z"
                                            stroke-linecap="round" />
                                    </g>
                                </g>
                            </g>
                        </svg></div>
                    <h3 class="card-title">Área de Votação</h3>
                    <p class="card-text">Registe o seu CC, obtenha a credencial e exerça o seu direito de voto.</p>
                    <a href="voting" class="btn btn-primary btn-lg w-100 stretched-link">Ir para Votação</a>
                </div>
            </div>
        </div>

        <div class="col-md-5 mb-4">
            <div class="card h-100 shadow-sm border-info">
                <div class="card-body text-center">
                    <div class="fs-1 mb-3">
                        <svg id='Ranking_First_24' width='44' height='44' viewBox='0 0 24 24'
                            xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
                            <rect width='24' height='24' stroke='none' fill='#000000' opacity='0' />


                            <g transform="matrix(0.83 0 0 0.83 12 12)">
                                <g style="">
                                    <g transform="matrix(1 0 0 1 0 1.5)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-12, -13.5)" d="M 7.5 6 L 16.5 6 L 16.5 21 L 7.5 21 z"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 8 2.5)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-20, -14.5)"
                                            d="M 16.5 11 L 16.5 8 L 21.5 8 C 21.80159819270105 8.016334851747153 22.074271301512713 8.184684133016233 22.224 8.447 L 23.277 10.552 C 23.41243724073266 10.850131371665805 23.48851998628887 11.17178476470925 23.501 11.498999999999999 L 23.501 20.499 C 23.501 20.775142374915397 23.2771423749154 20.999 23.001 20.999 L 16.5 20.999 L 16.5 11"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 -8 2.5)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-4, -14.5)"
                                            d="M 7.5 11 L 7.5 8 L 2.5 8 C 2.198401807298951 8.016334851747153 1.9257286984872855 8.184684133016235 1.7760000000000002 8.447 L 0.723 10.552 C 0.5877811752240618 10.850510517710992 0.5120358878362485 11.172512905350663 0.49999999999999967 11.500000000000002 L 0.5 20.5 C 0.5 20.7761423749154 0.7238576250846033 21 1 21 L 7.5 21 L 7.5 11"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 0 -7.5)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-12, -4.5)"
                                            d="M 7.5 6 L 8.776 3.447 C 8.925728698487285 3.1846841330162348 9.19840180729895 3.0163348517471538 9.5 3 L 14.5 3 C 14.80159819270105 3.0163348517471538 15.074271301512715 3.1846841330162348 15.224 3.447 L 16.5 6 Z"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 8 -1)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-20, -11)" d="M 16.5 11 L 23.5 11"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 8.02 4)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-20.02, -16)"
                                            d="M 19.032 14.741 C 19.166217334782292 14.240473859434072 19.660563786319493 13.925404330673404 20.170952386366103 14.015093724072782 C 20.68134098641271 14.10478311747216 21.038655119556957 14.569512966262044 20.994188364618793 15.085810766035735 C 20.94972160968063 15.602108565809425 20.518207969521402 15.998899695318928 20 16 C 20.51704511684723 16.000444620988954 20.948493452028668 16.394967388873553 20.995073755628255 16.909910226341907 C 21.041654059227838 17.424853063810257 20.6880046695535 17.89039359855791 20.179432118696464 17.98361275462659 C 19.670859567839432 18.076831910695276 19.175085379027564 17.76698705594036 19.036 17.269"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 -8 4)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-4, -16)"
                                            d="M 3 15 C 3 14.447715250169207 3.4477152501692068 14 4 14 L 4 14 C 4.552284749830793 14 5 14.447715250169207 5 15 L 5 15 C 5.000190577989977 15.323507161690484 4.890143521703931 15.63742344404491 4.688 15.89 L 3 18 L 5 18"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 0 1)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-12, -13)"
                                            d="M 11.5 11 L 12 11 C 12.276142374915397 11 12.5 11.223857625084603 12.5 11.5 L 12.5 15"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 0.5 3)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-12.5, -15)" d="M 11.498 15 L 13.498 15"
                                            stroke-linecap="round" />
                                    </g>
                                    <g transform="matrix(1 0 0 1 -8 -0.5)">
                                        <path
                                            style="stroke: rgb(0,0,0); stroke-width: 1; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;"
                                            transform=" translate(-4, -11.5)" d="M 0.5 11.5 L 7.5 11.5"
                                            stroke-linecap="round" />
                                    </g>
                                </g>
                            </g>
                        </svg>
                    </div>
                    <h3 class="card-title">Resultados em Tempo Real</h3>
                    <p class="card-text">Consulte a contagem atual dos votos para cada candidato e o estado da eleição.
                    </p>
                    <a href="results" class="btn btn-info text-white btn-lg w-100 stretched-link">Ver Resultados</a>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="text-center mt-5 text-muted">
    <small>Desenvolvido em .NET 9 (Blazor Server) + gRPC</small>
</footer>

@code {
    private string serverStatus = "A verificar...";
    private string statusBadgeClass = "bg-warning text-dark";

    protected override async Task OnInitializedAsync()
    {
        // Ao entrar na Home Page, é realizado um ping ao servidor
        try
        {
            // Timeout de apenas 2 segundos para não prender a página
            await VotingClient.GetCandidatesAsync(new GetCandidatesRequest(), deadline: DateTime.UtcNow.AddSeconds(2));

            serverStatus = "Online (Conectado)";
            statusBadgeClass = "bg-success";
        }
        catch (Exception)
        {
            serverStatus = "Offline / Indisponível";
            statusBadgeClass = "bg-danger";
        }
    }
}